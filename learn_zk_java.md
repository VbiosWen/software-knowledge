# 从Paxos到Zookeeper的分布式一致性协议原理与实践 :yum:
- ## [分布式架构](#1)
- ## [一致性协议](#2)
- ## [Zookeeper与Paxos](#3)
- ## [使用Zookeeper](#4)
- ## [Zookeeper的典型应用](#5)
- ## [Zookeeper的技术内幕](#6)
- ## [Zookeeper运维](#7)



 - ## <p id="1">分布式架构</p>
   随着计算机系统规模变得越来越大，单机已经无法满足业务的需要。这个时候就需要多台机器甚至几千台机器运行业务，这个时候就需要考虑数据的一致性，可用性，以及如何协调成千上万台机器的工作，分布式理论由此而生。
   - ### <p id="1_1">从集中式到分布式</p>
     从20世纪60年代大型主机发明出来后，凭借其超强的计算处理能力以及I/O处理能力以及在安全性稳定性的卓越表现，在很长一段时间，大型主机引领了计算机行业以及商业计算领域的发展。我所了解到的是IBM的小型机和大型机。随着这些优秀的主机的出现，集中式的计算机系统架构也成为了主流。对应的系统也被称为集中式系统。最为典型的就是阿里的淘宝系，从2008年以后，淘宝的业务进入了井喷式的发展阶段，这对于后台系统的计算与存储能力提出了非常高的要求，一味地针对小型机和高端存储进行不断扩容，会产生巨大的成本。同时集中式的系统架构体系也存在诸多单点问题，完全无法满足互联网应用爆炸式的发展需求。(_据我了解，早期淘宝是让买了一套Oracle的一套系统，基于PHP开发的，然后淘宝只需要维护和迭代就行，同时数据库也用的Oracle的，机器是IBM的，所以整套系统非常耗钱，而且业务的增长导致需要不断的扩容。到最后就算是扩容也无法满足他们的业务场景了，所以才开始了去IOE计划，改用Java重构整个系统。其电商系统也正式进入了分布式系统时代。非常佩服他们领导人的决策力。_)
     - __集中式的特点__
       所谓的集中式系统就是指由一台或多台主计算机组成中心节点，数据集中存储于这个中心节点中，并且整个系统的所有业务单元都集中部署在这个中心节点上，系统的所有功能均由中心节点处理。也就是说，在集中式系统架构中，每个终端或客户机器仅仅负责数据的录入和输出，而数据的存储与控制处理完全交由主机finish.
       集中式系统最大的特点就是部署简单，由于集中式系统往往基于底层性能卓越的大型主机，因此无需考虑如何对服务进行多节点部署，也就不用考虑多节点之间的分布式协作问题。
     - __分布式的特点__
       _分布式系统是一个硬件或软件组件分布在不同的网络计算机上，彼此之间仅仅通过消息传递进行通信和协调的系统。_
       严格来讲，分布式系统中的计算机在空间部署上是可以随意分布的，也叫异地容灾，一个标准的分布式系统在没有任何特定业务逻辑约束的情况下，有如下特征:
       - 1. 分布性
         分布式系统中的多台计算机都会在空间上随意分布，同时机器的分布情况会随时变动。
       - 2. 对等性
         分布式系统中的计算机没有主/从之分，即没有控制整个系统的主机，也没有被控制的从机，组成分布式系统的所有计算机节点都是对等的。副本是分布式系统最常见的概念之一，是分布式系统对数据和服务提供的一种冗余方式。在常见的分布式系统中，为了保证高可用，往往对数据和服务进行副本处理。副本我的理解就是在不同的节点持节化同一份数据或者服务，当一个节点的数据丢失时，或者服务不可用时，可以切换到副本节点上，这是解决分布式系统数据丢失和服务不可用问题的最为有效的手段。
       - 3. 并发性
         在"问题的提出"部分，我们已经提到过与"更新的并发性"相关的内容。在一个计算机网络中，程序运行过程中的并发性操作时非常常见的行为，例如同一个分布式系统中的多个节点，可能会并发地操作一些共享资源，诸如数据库或分布式存储等，如何准确并高效地协调分布式并发操作也成为分布式系统架构与设计中最大的挑战之一。
       - 4. 缺乏全局时钟
         典型的分布式系统是由一系列在空间上随意分布的多个进程组成的，具有明显的分布性，这些进程之间通过交换消息来进行相互通信，因此在分布式系统中，需要判断两个事件究竟谁先谁后，原因就是因为分布式系统缺乏一个全局的时钟系列控制。
       - 5. 故障总是会发生
         组成分布式系统的所有计算机，都有可能发生任何形式的故障。_黄金定理:任何在设计阶段考虑到的异常情况，一定会在系统实际运行中发生，并且，在新系统实际运行过程中还会遇到在设计时未能考虑到的异常故障，所以，除非需求指标允许，在系统设计时不能放过任何异常情况。
     - __分布式环境的各种问题__  
       - 1. 通信异常
         在集中式向分布式演变的过程中，必然引入了网络因素，而由于网络本身的不可靠性，因此也引入了额外的问题。分布式系统需要在各个节点之间进行网络通信,因此每次网络通信会伴随着网络不可用的风险,网络光纤,路由器或者DNS等硬件设备或是系统不可用都会导致最终分布式系统无法顺利完成一次网络通信,另外,即使分布式系统之间的网络通信能够正常进行,其延时也会远大于单机操作.通常我们认为在现代计算机体系中,单机内内存访问的延时在纳秒数量级,而正常的一次网络通信的延迟在0.1~1ms左右,因此消息丢失和消息延迟变得非常普遍.
       - 2. 网络分区
         当网络由于发生异常情况,导致分布式系统中部分节点之间的网络延时不断增大,最终导致组成分布式系统的所有节点中,只有部分节点之间能够进行正常通信,而另一些节点则不能,这个现象称为网络分区,也叫脑裂,当网络分区发生时,分布式系统会出现局部小集群,在极端情况下,这些局部小集群会独立完成原本需要整个分布式系统才能完成的功能,包括对数据的事务处理,这就对分布式一致性提出了非常大的挑战.    
       - 3. 三态
         在分布式系统中有三态的概念,即成功,失败与超时.
       - 4. 节点故障
           